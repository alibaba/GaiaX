# 快速入门

<cite>
**本文档引用的文件**   
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt)
- [GaiaXiOS.h](file://GaiaXiOS/GaiaXiOS/GaiaXiOS.h)
- [README.md](file://GaiaXAndroid/README.md)
- [README.md](file://GaiaXiOS/README.md)
- [README.md](file://GaiaXHarmony/README.md)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备](#环境准备)
3. [核心概念](#核心概念)
4. [创建第一个模板](#创建第一个模板)
5. [Android集成](#android集成)
6. [iOS集成](#ios集成)
7. [HarmonyOS集成](#harmonyos集成)
8. [最佳实践](#最佳实践)

## 简介
GaiaX是一个轻量级的跨平台纯原生动态卡片解决方案，由阿里巴巴优酷技术团队开发。该框架旨在确保原生体验和性能的同时，帮助客户端实现低代码开发。本指南将详细介绍如何在Android、iOS和HarmonyOS平台上集成和使用GaiaX框架，从环境准备到创建第一个动态模板的完整流程。

## 环境准备
在开始使用GaiaX框架之前，需要准备相应的开发环境和工具。

### Android开发环境
- **开发工具**：Android Studio Flamingo | 2022.2.1 Patch 2
- **JDK版本**：11.0.18

### iOS开发环境
- **依赖管理**：通过CocoaPods进行依赖管理
- **验证命令**：
```shell
pod spec lint ./GaiaXiOS.podspec --verbose --allow-warnings  --skip-import-validation
```
- **发布命令**：
```shell
pod trunk push GaiaXiOS.podspec --skip-import-validation --verbose --allow-warnings
```

### HarmonyOS开发环境
- **IDE**：DevEco Studio NEXT Developer Beta1
- **构建版本**：5.0.3.300，构建于2024年5月10日
- **API版本**：12

**Section sources**
- [README.md](file://GaiaXAndroid/README.md#L1-L8)
- [README.md](file://GaiaXiOS/README.md#L1-L10)
- [README.md](file://GaiaXHarmony/README.md#L1-L7)

## 核心概念
理解GaiaX框架的核心概念是成功集成和使用该框架的基础。

### GXTemplateEngine
`GXTemplateEngine`是GaiaX框架的核心引擎类，负责模板的创建、数据绑定和UI渲染等核心功能。它提供了初始化、创建视图、绑定数据等关键方法。

### GXTemplateItem
`GXTemplateItem`类用于封装模板信息参数，包括：
- **context**：Android上下文
- **bizId**：模板业务ID
- **templateId**：模板ID
- **isLocal**：是否为本地模板
- **isPageMode**：是否为页面模式

### GXTemplateData
`GXTemplateData`类用于封装模板数据参数，主要包含：
- **data**：模板数据，用于绑定到视图
- **dataListener**：数据处理监听器
- **eventListener**：事件监听器
- **trackListener**：埋点监听器

### GXMeasureSize
`GXMeasureSize`是一个限制性概念，规定了GaiaX模板内容的最大显示区域。它有三种使用情况：
1. 固定宽度和高度
2. 固定宽度，不确定高度
3. 不确定宽度，确定高度

**Section sources**
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L77-L927)

## 创建第一个模板
本节将详细介绍从零开始创建第一个动态模板的分步教程。

### 引擎初始化
在使用GaiaX框架之前，需要先初始化引擎。

```kotlin
// Android平台初始化
GXTemplateEngine.instance.init(activity)
```

```objective-c
// iOS平台初始化
[[GXTemplateEngine sharedEngine] setupWithApplication:application];
```

### 模板参数构建
构建模板参数是创建模板的第一步。

```kotlin
// 构建模板参数
val params = GXTemplateEngine.GXTemplateItem(activity, "template biz", "template id")
```

### 测量尺寸设置
设置模板的测量尺寸，这类似于绘图系统的视口。

```kotlin
// 构建测量尺寸
val size = GXTemplateEngine.GXMeasureSize(screenWidth, null)
```

### 模板数据准备
准备模板数据，用于绑定到视图。

```kotlin
// 构建模板数据
val templateData = GXTemplateEngine.GXTemplateData(jsonData)
```

### 视图创建与数据绑定
创建视图并绑定数据。

```kotlin
// 创建视图
val view = GXTemplateEngine.instance.createView(params, size)

// 更新数据
GXTemplateEngine.instance.bindData(view, templateData)

// 注入容器
findViewById<LinearLayoutCompat>(R.id.xxx).addView(view, 0)
```

**Section sources**
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L58-L76)

## Android集成
本节详细介绍如何在Android平台上集成GaiaX框架。

### 依赖添加
在项目的`build.gradle`文件中添加GaiaX依赖。

### 引擎初始化
在Application或Activity中初始化GaiaX引擎。

```kotlin
// SDK初始化方法
fun init(context: Context): GXTemplateEngine {
    this.context = context.applicationContext
    GXStyleConvert.instance.init(context.assets)
    GXRegisterCenter.instance.registerExtensionExpression(GXExtensionExpression())
        // priority 0
        .registerExtensionTemplateInfoSource(GXTemplateInfoSource.instance, 0)
        // priority 0
        .registerExtensionTemplateSource(GXAssetsBinaryWithoutSuffixTemplate(this.context), 0)
        // priority 1
        .registerExtensionTemplateSource(GXAssetsTemplate(this.context), 1)

    // init adapter
    // 无实际的依赖关系，仅仅是帮助GXAdapter进行初始化
    // GXAdapter内的逻辑可以写在任意地方
    initGXAdapter()?.init(context)
    return this
}
```

### 视图创建
使用`createView`方法创建模板视图。

```kotlin
/**
 * 根据模板信息和测量尺寸创建模板视图。
 *
 * @param gxTemplateItem 模板信息，包含模板ID(templateId)和模板业务ID(bizId)。
 * @param gxMeasureSize 模板测量尺寸，类似于绘图系统的视口，用于确定模板视图的大小。
 *
 * @return 由模板生成的视图
 */
fun createView(
    gxTemplateItem: GXTemplateItem,
    gxMeasureSize: GXMeasureSize,
    gxExtendParams: GXExtendParams? = null
): View?
```

### 数据绑定
使用`bindData`方法绑定模板数据。

```kotlin
/**
 * 绑定模板数据
 *
 * @param gxView 根视图
 * @param gxTemplateData 模板数据
 * @param gxMeasureSize 模板测量尺寸，类似于绘图系统的视口，用于确定模板视图的大小。
 * @throws IllegalArgumentException
 */
fun bindData(gxView: View?, gxTemplateData: GXTemplateData, gxMeasureSize: GXMeasureSize? = null)
```

### 生命周期管理
正确管理视图的生命周期，包括出现和消失的回调。

```kotlin
// 通知视图可见
fun onAppear(targetView: View?)

// 通知视图不可见
fun onDisappear(targetView: View?)
```

**Section sources**
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L888-L905)
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L557-L582)
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L592-L609)
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L866-L884)

## iOS集成
本节详细介绍如何在iOS平台上集成GaiaX框架。

### 头文件导入
在项目中导入GaiaX的主要头文件。

```objective-c
#import <GaiaXiOS/GaiaXiOS.h>
```

### 引擎初始化
初始化GaiaX引擎。

```objective-c
[[GXTemplateEngine sharedEngine] setupWithApplication:application];
```

### 模板创建
使用`GXTemplateEngine`创建模板视图。

```objective-c
// 创建模板引擎实例
GXTemplateEngine *engine = [GXTemplateEngine sharedEngine];

// 创建模板项
GXTemplateItem *item = [[GXTemplateItem alloc] initWithContext:context 
                                                       bizId:bizId 
                                                  templateId:templateId];

// 创建视图
UIView *view = [engine createViewWithTemplateItem:item 
                                       measureSize:size];
```

### 数据绑定
绑定模板数据到视图。

```objective-c
// 创建模板数据
GXTemplateData *data = [[GXTemplateData alloc] initWithData:jsonData];

// 绑定数据
[engine bindData:view 
          templateData:data 
           measureSize:size];
```

### 事件处理
实现事件监听器以处理用户交互。

```objective-c
// 实现GXIEventListener协议
- (void)onGestureEvent:(GXGesture *)gxGesture {
    // 处理手势事件
}

- (void)onScrollEvent:(GXScroll *)gxScroll {
    // 处理滚动事件
}

- (void)onAnimationEvent:(GXAnimation *)gxAnimation {
    // 处理动画事件
}
```

**Section sources**
- [GaiaXiOS.h](file://GaiaXiOS/GaiaXiOS/GaiaXiOS.h#L1-L56)

## HarmonyOS集成
本节介绍如何在HarmonyOS平台上集成GaiaX框架。

### 环境配置
确保开发环境满足以下要求：
- **IDE**：DevEco Studio NEXT Developer Beta1
- **API版本**：12

### 项目结构
GaiaX在HarmonyOS上的项目结构主要包括：
- **GXStretchBinding**：Stretch布局绑定
- **GaiaXAnalyze**：分析模块
- **GaiaXCore**：核心模块

### 集成步骤
1. 在DevEco Studio中创建新项目
2. 添加GaiaX依赖
3. 配置项目构建文件
4. 初始化GaiaX引擎

### 模板渲染
使用GaiaXCore模块进行模板渲染。

```ets
// 在HarmonyOS上创建模板
import { GaiaX } from '@ohos/gaiax';

const gaiaX = new GaiaX();
gaiaX.init(context);
const view = gaiaX.createView(templateItem, measureSize);
```

**Section sources**
- [README.md](file://GaiaXHarmony/README.md#L1-L7)

## 最佳实践
本节提供有经验开发者可以参考的最佳实践建议。

### 性能优化
- **缓存机制**：合理使用`GXGlobalCache`进行布局结果缓存
- **视图复用**：在列表场景中复用视图节点
- **异步处理**：将耗时操作放在后台线程执行

### 错误处理
- **异常捕获**：使用`GXExceptionHelper`捕获和处理异常
- **日志记录**：启用`GXPropUtils.isTrace()`进行调试跟踪
- **资源清理**：及时调用`clean()`方法清理缓存

### 代码结构
- **模块化设计**：将不同功能模块分离
- **接口抽象**：使用`GXIAdapter`接口进行功能扩展
- **数据驱动**：遵循数据绑定的设计模式

### 调试技巧
- **使用GaiaXStudio**：利用可视化构建工具进行实时预览
- **埋点监控**：实现`GXITrackListener`进行用户行为分析
- **性能分析**：使用系统提供的性能分析工具

**Section sources**
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L916-L919)
- [GXTemplateEngine.kt](file://GaiaXAndroid/src/main/kotlin/com/alibaba/gaiax/GXTemplateEngine.kt#L523-L532)